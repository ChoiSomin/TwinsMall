<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<th:block layout:fragment="script">
    <script th:inline="javascript">

        $(document).ready(function(){
            $("#searchBtn").on("click",function(e) {
                e.preventDefault();
                page(0);
            });
        });

        function page(page){
            var searchDateType = $("#searchDateType").val();
            var searchSellStatus = $("#searchSellStatus").val();
            var searchBy = $("#searchBy").val();
            var searchQuery = $("#searchQuery").val();

            location.href="/order/orderDetail/{ono}/" + page + "?searchDateType=" + searchDateType
                + "&searchSellStatus=" + searchSellStatus
                + "&searchBy=" + searchBy
                + "&searchQuery=" + searchQuery
                + "&currentPage=" + [[${currentPage}]];
        }

        function cancelOrder(orderId) {

            var url = "/order/" + orderId + "/cancel";
            var paramData = {
                orderId: orderId,
            };

            var param = JSON.stringify(paramData);

            $.ajax({
                url: url,
                type: "POST",
                contentType: "application/json",
                data: param,
                dataType: "json",
                cache: false,
                success: function (result, status) {
                    alert("주문이 취소 되었습니다.");
                    location.href = '/orders/';
                },
                error: function (jqXHR, status, error) {
                    if (jqXHR.status == '401') {
                        alert('로그인 후 이용해주세요');
                        location.href = '/members/login';
                    } else {
                        alert(jqXHR.responseText);
                    }
                }
            });
        }

    </script>
</th:block>

<div layout:fragment="content">

    <div class="mypage-order-detail">
        <div class="shop">
            <div class="heading-shop">Order</div>
            <div class="overlap-group">
                <div class="link-home">주문내역</div>
            </div>
        </div>
        <div class="view">
            <div class="nav-list-item-link-4">주문정보</div>
            <a th:href="@{/orders}">
                <div class="nav-list-item-link-5">주문내역</div>
            </a>
            <div class="nav-list-item-link-6">회원정보</div>
            <a th:href="@{/mypage/read}">
                <div class="nav-list-item-link-7">내정보</div>
            </a>
            <a th:href="@{/mypage/shipping/list}">
                <div class="nav-list-item-link-11">배송지 정보</div>
            </a>
            <div class="nav-list-item-link-8">서비스</div>
            <div class="nav-list-item-link-9">1:1문의</div>
            <div class="nav-list-item-link-10">나의 리뷰</div>

        </div>
        <div class="overlap">
            <div class="frame">
                <div class="table-wrapper">
                    <th:block th:each="order : ${orders.getContent()}">
                        <th:block th:each="member : ${order.memberJoinDTO}">
                            <div class="table">
                                <div class="row">
                                    <div class="cell">
                                        <div class="content">
                                            <div class="text">주문번호</div>
                                        </div>
                                    </div>
                                    <div class="content-wrapper">
                                        <div class="content">
                                            <div class="text-2" th:text="${order.orderId}"></div>
                                        </div>
                                    </div>
                                    <div class="cell">
                                        <div class="content">
                                            <div class="text-3">주문일</div>
                                        </div>
                                    </div>
                                    <div class="content-wrapper">
                                        <div class="content">
                                            <div class="text-2" th:text="${order.orderDate}"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </th:block>
                    </th:block>
                    <div class="row">
                        <div class="div-wrapper">
                            <div class="content">
                                <div class="text">주문자</div>
                            </div>
                        </div>
                        <div class="cell-2">
                            <div class="content">
                                <div class="text-2" th:text="${member.mname}"></div>
                            </div>
                        </div>
                        <div class="cell-3">
                            <div class="content">
                                <div class="text-3">TEL</div>
                            </div>
                        </div>
                        <div class="cell-2">
                            <div class="content">
                                <div class="text-2"
                                     th:text="${#strings.substring(member.mphone, 0, 3) + '-'
                                     + #strings.substring(member.mphone, 3, 7) + '-'
                                     + #strings.substring(member.mphone, 7)}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <th:block th:each="order : ${orders.getContent()}">
                    <div class="view-2">
                        <div class="table-2">
                            <div class="row">
                                <div class="cell">
                                    <div class="content">
                                        <div class="text">배송번호</div>
                                    </div>
                                </div>
                                <div class="content-wrapper">
                                    <div class="content">
                                        <div class="text-2" th:text="${order.orderId}"></div>
                                    </div>
                                </div>
                                <div class="cell">
                                    <div class="content">
                                        <div class="text-3">주문상태</div>
                                    </div>
                                </div>
                                <div class="content-wrapper">
                                    <div class="content">
                                        <div class="text-2" th:text="${order.orderStatus}"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="div-wrapper">
                                    <div class="content">
                                        <div class="text">받는분</div>
                                    </div>
                                </div>
                                <div class="cell-2">
                                    <div class="content">
                                        <div class="text-2" th:text="${member.mname}"></div>
                                    </div>
                                </div>
                                <div class="cell-3">
                                    <div class="content">
                                        <div class="text">받는분 TEL</div>
                                    </div>
                                </div>
                                <div class="cell-2">
                                    <div class="content">
                                        <div class="text-2" th:text="${#strings.substring(member.mphone, 0, 3) + '-'
                                            + #strings.substring(member.mphone, 3, 7) + '-'
                                            + #strings.substring(member.mphone, 7)}">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="div-wrapper">
                                    <div class="content">
                                        <div class="text">배송주소</div>
                                    </div>
                                </div>
                                <div class="cell-2">
                                    <div class="content">
                                        <div class="text-2"
                                             th:text="${#strings.substring(order.address, 0, order.address.lastIndexOf('/') - 1)}"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </th:block>
                <div class="view-3">
                    <div class="table-header">
                        <div class="row-cell-product">주문상품</div>
                        <div class="row-cell-quantity">수량</div>
                        <div class="row-cell-total">총가격</div>
                    </div>
                    <!-- orderId를 출력 -->
                    <th:block th:each="order : ${orders.getContent()}">
                        <!-- OrderHistDto에서 orderItemDtoList를 페이징 처리 -->
                        <th:block th:with="orderItemsPage=${order.orderItemDtoList.subList(0, 3)}">
                            <th:block th:each="orderItem : ${orderItemsPage}">
                                <div class="table-body-row">
                                    <img class="data-cart-jpg" th:src="${orderItem.imgUrl}" th:alt="${orderItem.itemNm}"/>
                                    <div class="data">
                                        <div class="heading-t-shirt">
                                            <span th:text="${orderItem.itemNm}"></span>
                                        </div>
                                    </div>
                                    <div class="data-input">
                                        <div class="div-2">
                                            <div class="text-wrapper-3">
                                                <span th:text="${orderItem.count + '개'}"></span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="data-2">
                                        <span class="totaltotal" data-th-text="| ${#numbers.formatInteger(orderItem.orderPrice*orderItem.count, 3, 'COMMA')} 원 |"></span>
                                    </div>
                                </div>
                            </th:block>
                        </th:block>
                    </th:block>


                </div>

                <!--<div class="row-wrapper">
                    <div class="row">
                        <div class="cell">
                            <div class="content">
                                <div class="text">총 결제금액 : <span id="orderTotalPrice">원</span></div>
                            </div>
                        </div>
                        <div class="content-wrapper">
                            <div class="content">
                                <div class="text-2"></div>
                            </div>
                        </div>
                        <div class="cell">
                            <div class="content">
                                <div class="text-3">결제방식</div>
                            </div>
                        </div>
                        <div class="content-wrapper">
                            <div class="content">
                                <div class="text-2"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>-->
                <div class="view-4">
                    <th:block th:each="order : ${orders.getContent()}">
                        <div class="frame-2">
                            <a href="#">
                                <div class="text-wrapper-4">문의하기</div>
                            </a>
                        </div>
                        <div class="frame-3" th:if="${order.orderStatus == T(com.mall.twins.twinsmall.constant.OrderStatus).ORDER}">
                            <a href="#" class="text-wrapper-5" th:attr="data-orderid=${order.orderId}"
                               onclick="cancelOrder(this.getAttribute('data-orderid'))">주문취소</a>
                        </div>
                        <div class="frame-3" th:if="${order.orderStatus == T(com.mall.twins.twinsmall.constant.OrderStatus).CANCEL}">
                            <a href="#" class="text-wrapper-5" th:attr="data-orderid=${order.orderId}"
                               onclick="cancelOrder(this.getAttribute('data-orderid'))">취소완료</a>
                        </div>
                        <!--<div class="blog__details__tags"
                             th:if="${order.orderStatus == T(com.no3.game.constant.OrderStatus).ORDER}">
                            <a href="#" class="blog__details__tags" th:attr="data-orderid=${order.orderId}"
                               onclick="cancelOrder(this.getAttribute('data-orderid'))">Cancel Order</a>
                        </div>
                        <div class="blog__details__tags"
                             th:unless="${order.orderStatus == T(com.no3.game.constant.OrderStatus).ORDER}">
                            <a href="#">(Cancel complete)</a>-->
                        <div class="frame-4">
                            <a href="#">
                                <div class="text-wrapper-4">리뷰쓰기</div>
                            </a>
                        </div>
                    </th:block>

                </div>

            </div>

        </div>
        <div class="orderDetail-footer">
            <footer class="footer">
                <div class="overlap-5">
                    <div class="div-container">
                        <p class="based-on-the-life-s">Based on the &#39;Life&#39;s Good&#39; brand philosophy,</p>
                        <p class="text-wrapper-11">we always strives to provide First, Unique,</p>
                        <div class="overlap-6">
                            <p class="text-wrapper-12">and New F·U·N experiences to provide</p>
                            <p class="text-wrapper-13">customers with a better life.</p>
                        </div>
                        <a th:href="@{/templates/item/item.html}">
                            <div class="heading-shopping">SHOPPING</div>
                            <div class="list-item-link">Refrigerator</div>
                            <div class="list-item-link-2">TV</div>
                            <div class="list-item-link-3">Laptop</div>
                            <div class="list-item-link-sale">Washing Machine</div>
                            <div class="list-item-link-4">Air Purifier</div>
                            <div class="list-item-link-5">Air Conditioner</div>
                            <div class="list-item-link-6">Cleaner</div>
                            <div class="heading-newletter">OTHERS</div>
                            <div class="div-footer-copyright">
                                <div class="overlap-group-2">
                                    <div class="text-wrapper-14">Copyright ©</div>
                                    <p class="text-wrapper-15">20232020 All rights reserved | This template is made
                                        with</p>
                                    <div class="symbol-3"></div>
                                    <div class="by">by</div>
                                    <div class="link-colorlib">Colorlib</div>
                                </div>
                            </div>
                            <div class="list-item-link-7">About us</div>
                            <div class="list-item-link-8">FAQ</div>
                            <div class="list-item-link-9">Contact</div>
                            <p class="element">
                <span class="span"
                >개인정보처리방침<br/>이벤트 개인정보처리방침<br/>영상정보처리기기운영관리방침<br/><br/>대표번호 :
                </span>
                                <a href="tel:02-3777-1114" target="_blank" rel="noopener noreferrer"
                                ><span class="text-wrapper-16">02-</span></a
                                >
                                <span class="span"
                                >1234-1234<br/>전화상담 시간은 평일 09:00 ~ 18:00 (주말, 공휴일 휴무) 입니다. (통화요금 :
                  발신자부담)<br/>제품 및 서비스 문의는 긴급 문의 건에 한해 24시간 운영합니다.<br/>주소 : 경기도
                  수원시 경기도 수원시 팔달구 덕영대로 899 (매산로 1가, 세진브론즈빌 304호)<br/><br/>본 사이트의 모든
                  콘텐츠는 저작권법의 보호를 받는 바, 무단 전재, 복사, 배포 등을 금합니다.</span
                                >
                            </p>
                        </a>
                    </div>
                    <img class="img" src="/img/link-logo-png.png"/>
                </div>
            </footer>
        </div>
    </div>
</div>
</html>