<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
    <meta charset="UTF-8">
    <title>회원정보 수정</title>
</head>
<body>

<div>

    <div>
        회원정보 수정
    </div>

    <div>
        <form th:action="@{/mypage/modify}" method="post" id="mypageForm">

            <div>
                <span>아이디</span>
                <input type="text" name="mid" th:value="${dto.mid}" readonly>
            </div>

            <div>
                <span>비밀번호</span>
                <input type="password" name="mpassword">
            </div>

            <div>
                <span>이름</span>
                <input type="text" name="mname" th:value="${dto.mname}">
            </div>

            <div>
                <span>이메일</span>
                <input type="email" name="memail" th:value="${dto.memail}">
            </div>

            <div>
                <span>생년월일</span>
                <input type="text" name="mbirthday" th:value="${dto.mbirthday}" readonly>
            </div>

            <div>
                <span>전화번호</span>
                <input type="text" name="mphone" th:value="${dto.mphone}">
            </div>

            <div>
                <button type="button" class="modBtn">수정 완료</button>
                <button type="button" class="removeBtn">회원탈퇴</button>
            </div>

        </form>

    </div>

</div>

</body>

<script layout:fragment="script" th:inline="javascript">

    // @Valid 검증에서 에러가 발생할 시 erros라는 이름으로 에러 메시지 출력
    const errors = [[${errors}]]
    console.log(errors)

    let errorMsg = ''

    if(errors) {
        for (let i = 0; i < errors.length; i++) {
            errorMsg += `${errors[i].field}은(는) ${errors[i].code} \n`
        }

        // 현재 history를 수정해 메소드의 매개 변수에 전달 된 stateObj, title, URL로 대체
        history.replaceState({}, null, null)
        alert(errorMsg)
    }

    // 버튼 클릭 시 이벤트 활성화
    const formObj = document.querySelector("#mypageForm")

    document.querySelector(".modBtn").addEventListener("click", function(e) {
        e.preventDefault()
        e.stopPropagation()

        formObj.action = `/mypage/modify`
        formObj.method = 'post'
        formObj.submit()

    }, false)

    document.querySelector(".removeBtn").addEventListener("click", function(e) {
        e.preventDefault()
        e.stopPropagation()

        formObj.action = `/mypage/remove`
        formObj.method = 'post'
        formObj.submit()
    }, false)

</script>

</html>